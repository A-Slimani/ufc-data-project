SELECT 
  p.fighter_id,
  f.full_name,
  f.first_name,
  f.last_name,
  f.nick_name,
  f.hometown_city,
  f.hometown_state,
  f.hometown_country,
  f.hometown_country_tricode,
  f.trains_at_city,
  f.trains_at_state,
  f.trains_at_country,
  f.trains_at_country_tricode,
  f.weight_class_id,
  f.weight_class_description,
  f.weight_class_order,
  (f.wins + f.losses + f.draws) AS "total_fights",
  f.wins AS "total_wins",
  f.losses AS "total_losses",
  f.draws AS "total_draws",
  {{ get_percentage(['f.wins', 'f.losses', 'f.draws']) }} AS "total_win_percentage",
  p.ufc_fights,
  p.ufc_wins,
  p.ufc_losses,
  p.ufc_draws,
  p.ufc_no_contests,
  p.ufc_win_percentage,
  COALESCE(b.ufc_wins_by_ko_tko, 0) AS "ufc_wins_by_ko_tko",
  COALESCE(b.ufc_wins_by_sub, 0) AS "ufc_wins_by_sub",
  COALESCE(b.ufc_wins_by_dec, 0) AS "ufc_wins_by_dec", 
  COALESCE(fs.career_knockdowns, 0) AS "career_knockdowns",
  COALESCE(fs.career_takedowns_attempted, 0) AS "career_takedowns_attempted",
  COALESCE(fs.career_takedowns_landed, 0) AS "career_takedowns_landed",
  fs.career_takedown_accuracy,
  COALESCE(fs.career_sig_strikes_attempted, 0) AS "career_sig_strikes_attempted",
  COALESCE(fs.career_sig_strikes_landed, 0) AS "career_sig_strikes_landed",
  fs.career_sig_strike_accuracy,
  COALESCE(fs.career_total_strikes_attempted, 0) AS "career_total_strikes_attempted",
  COALESCE(fs.career_total_strikes_landed, 0) AS "career_total_strikes_landed",
  fs.career_total_strike_accuracy,
  COALESCE(fs.career_submissions_attempted, 0) AS "career_submissions_attempted",
  fs.career_control_time_seconds,
  {{ time_conversion('fs.career_control_time_seconds') }} AS career_control_time,
  fs.career_clinch_control_time_seconds,
  {{ time_conversion('fs.career_clinch_control_time_seconds') }} AS career_clinch_control_time,
  fs.career_ground_control_time_seconds,
  {{ time_conversion('fs.career_ground_control_time_seconds') }} AS career_ground_control_time
FROM {{ ref('int_fighter_ufc_stats') }} p
LEFT JOIN {{ ref('stg_fighters') }} f ON f.id = p.fighter_id
LEFT JOIN {{ ref('int_fighter_ufc_wins_by') }} b ON p.fighter_id = b.fighter_id
LEFT JOIN {{ ref('int_fighter_fight_stats') }} fs ON fs.fighter_id = f.id 
